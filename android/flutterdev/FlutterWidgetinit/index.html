



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="苍成坤的 blog">
      
      
        <link rel="canonical" href="https://squidfunk.github.io/mkdocs-material/android/flutterdev/FlutterWidgetinit/">
      
      
        <meta name="author" content="Aige">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>FlutterUI框架绘制过程 - Aige  Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "None", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#flutter-widget" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://squidfunk.github.io/mkdocs-material/" title="Aige  Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Aige  Docs
            </span>
            <span class="md-header-nav__topic">
              FlutterUI框架绘制过程
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cangchengkun/Docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Aige github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../project/websocket/" title="Project" class="md-tabs__link">
          Project
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../flutteradvance/" title="Android" class="md-tabs__link md-tabs__link--active">
          Android
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../python/base/pythonlang/" title="Python" class="md-tabs__link">
          Python
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../iot/Alexa/" title="IoT" class="md-tabs__link">
          IoT
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../secret/reousrce/" title="Secret" class="md-tabs__link">
          Secret
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../linux/resource/" title="Linux" class="md-tabs__link">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../shell/shellresource/" title="Shell" class="md-tabs__link">
          Shell
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../extensions/admonition/" title="Tools" class="md-tabs__link">
          Tools
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../download/download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://squidfunk.github.io/mkdocs-material/" title="Aige  Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Aige  Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cangchengkun/Docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Aige github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Project
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Project
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      SkyRoad
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        SkyRoad
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../project/websocket/" title="WebSocket" class="md-nav__link">
      WebSocket
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Android
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" checked>
    
    <label class="md-nav__link" for="nav-4-1">
      Flutter
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Flutter
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../flutteradvance/" title="Flutter学习路线" class="md-nav__link">
      Flutter学习路线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterUIframework/" title="FlutterUI和Engine关联" class="md-nav__link">
      FlutterUI和Engine关联
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        FlutterUI框架绘制过程
      </label>
    
    <a href="./" title="FlutterUI框架绘制过程" class="md-nav__link md-nav__link--active">
      FlutterUI框架绘制过程
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="引擎绘制原理" class="md-nav__link">
    引擎绘制原理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="大象装进冰箱里" class="md-nav__link">
    大象装进冰箱里
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo" title="官方Demo" class="md-nav__link">
    官方Demo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo_1" title="官方Demo 源码" class="md-nav__link">
    官方Demo 源码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flutter" title="Flutter架构" class="md-nav__link">
    Flutter架构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" title="核心问题点" class="md-nav__link">
    核心问题点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="输出的渲染对象" class="md-nav__link">
    输出的渲染对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderobjectelement" title="RenderObject和Element关系" class="md-nav__link">
    RenderObject和Element关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderobjecttowidgetadapter" title="RenderObjectToWidgetAdapter的构造函数中的参数冲那里来的？" class="md-nav__link">
    RenderObjectToWidgetAdapter的构造函数中的参数冲那里来的？
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#renderview" title="renderView对象" class="md-nav__link">
    renderView对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildowner" title="BuildOwner：" class="md-nav__link">
    BuildOwner：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reassemble" title="reassemble：" class="md-nav__link">
    reassemble：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildscope" title="buildScope：" class="md-nav__link">
    buildScope：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#widget" title="初始化Widget" class="md-nav__link">
    初始化Widget
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#element" title="初始化Element" class="md-nav__link">
    初始化Element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" title="是否创建节点的核心算法:" class="md-nav__link">
    是否创建节点的核心算法:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inflatewidget-element" title="inflateWidget 真正创建Element的地方" class="md-nav__link">
    inflateWidget 真正创建Element的地方
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="绘制第一帧" class="md-nav__link">
    绘制第一帧
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipeline" title="Pipeline" class="md-nav__link">
    Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipeline_1" title="pipeline" class="md-nav__link">
    pipeline
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flushlayout" title="flushLayout" class="md-nav__link">
    flushLayout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushcompositingbits" title="flushCompositingBits" class="md-nav__link">
    flushCompositingBits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushpaint" title="flushPaint" class="md-nav__link">
    flushPaint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderviewcompositeframe" title="renderView.compositeFrame()" class="md-nav__link">
    renderView.compositeFrame()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="如何计算渲染对象的摆放位置和自定义控件" class="md-nav__link">
    如何计算渲染对象的摆放位置和自定义控件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../platform_channels/" title="PlatformChannel" class="md-nav__link">
      PlatformChannel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../isolatedev/" title="ISOlate使用" class="md-nav__link">
      ISOlate使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../futterStream/" title="Future&Stream" class="md-nav__link">
      Future&Stream
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../applifecyclestate/" title="Flutter生命周期管理" class="md-nav__link">
      Flutter生命周期管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flutterNavigator/" title="FlutterNavigator" class="md-nav__link">
      FlutterNavigator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterLib/" title="Flutter库" class="md-nav__link">
      Flutter库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fluttersnip/" title="代码片段" class="md-nav__link">
      代码片段
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterKey/" title="FlutterKey" class="md-nav__link">
      FlutterKey
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutter/" title="Flutter" class="md-nav__link">
      Flutter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterTools/" title="FlutterSdk" class="md-nav__link">
      FlutterSdk
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter_project/flutterApp/" title="Flutter项目经验" class="md-nav__link">
      Flutter项目经验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../customWidget/" title="自定义Widget" class="md-nav__link">
      自定义Widget
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flutterImageProvider/" title="Flutter图片加载" class="md-nav__link">
      Flutter图片加载
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Flutterdeployment/" title="FlutterAndroid&IOS打包" class="md-nav__link">
      FlutterAndroid&IOS打包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flutterTest/" title="Flutter测试" class="md-nav__link">
      Flutter测试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/Architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterDev/" title="Flutter开发" class="md-nav__link">
      Flutter开发
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterexample/" title="example" class="md-nav__link">
      example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterQuestion/" title="Flutter常见问题" class="md-nav__link">
      Flutter常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterUI/" title="FlutterUI" class="md-nav__link">
      FlutterUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/interview/" title="面试资料" class="md-nav__link">
      面试资料
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      FlutterEngine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        FlutterEngine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/downEngine/" title="Engine源代码下载" class="md-nav__link">
      Engine源代码下载
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/ComplieMode/" title="编译模式" class="md-nav__link">
      编译模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/EngineCompile/" title="FlutterEngine编译" class="md-nav__link">
      FlutterEngine编译
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/GNTools/" title="GNTools" class="md-nav__link">
      GNTools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/NinjaSystem/" title="Ninja编译系统" class="md-nav__link">
      Ninja编译系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/EngineCompile/" title="Engine编译构建" class="md-nav__link">
      Engine编译构建
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterComplieFile/" title="Engine编译产物" class="md-nav__link">
      Engine编译产物
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/ComplieMode/" title="编译模式" class="md-nav__link">
      编译模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/apkfile/" title="Apk&ipd包分析" class="md-nav__link">
      Apk&ipd包分析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterAndroidInit/" title="Android加载Dart文件" class="md-nav__link">
      Android加载Dart文件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/AndroidViewinit/" title="Android初始化View" class="md-nav__link">
      Android初始化View
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/EngineInit/" title="Engine初始化" class="md-nav__link">
      Engine初始化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/EngineView/" title="EngineView初始化" class="md-nav__link">
      EngineView初始化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/SmartPtr/" title="C++智能指针" class="md-nav__link">
      C++智能指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/NativeExtensions/" title="NativeExtensions" class="md-nav__link">
      NativeExtensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/MessageLoop/" title="MessageLoop" class="md-nav__link">
      MessageLoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/DartVM/" title="初始化DartVM" class="md-nav__link">
      初始化DartVM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/platformplugin/" title="PlatformChannel" class="md-nav__link">
      PlatformChannel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/DartVMServiceProtocol/" title="DartVMServiceProtocol" class="md-nav__link">
      DartVMServiceProtocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/FlutterSupportView/" title="FlutterSupportView" class="md-nav__link">
      FlutterSupportView
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/profile/" title="性能优化" class="md-nav__link">
      性能优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/reviewCode/" title="reviewCode" class="md-nav__link">
      reviewCode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/DevResource/" title="资料" class="md-nav__link">
      资料
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/fluttercommunicationAndroidorIOS/" title="FlutterUI通信Android&IOS" class="md-nav__link">
      FlutterUI通信Android&IOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterEngine/" title="FlutterEngine源码编译" class="md-nav__link">
      FlutterEngine源码编译
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../flutter/flutterenginedir/" title="Flutter引擎目录" class="md-nav__link">
      Flutter引擎目录
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      ReactNative
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        ReactNative
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../rn/react_native/" title="ReactNative" class="md-nav__link">
      ReactNative
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Awsamplify
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Awsamplify
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../aws-android/awsamplify/" title="Awsamplify" class="md-nav__link">
      Awsamplify
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../androidTools/" title="AndroidTools" class="md-nav__link">
      AndroidTools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../issue/Androidissue/" title="Issue常见问题" class="md-nav__link">
      Issue常见问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/base/pythonlang/" title="语言基础" class="md-nav__link">
      语言基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/base/advancesPython/" title="高级开发" class="md-nav__link">
      高级开发
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/base/pythoninspect/" title="Python反射" class="md-nav__link">
      Python反射
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1-4" type="checkbox" id="nav-5-1-4">
    
    <label class="md-nav__link" for="nav-5-1-4">
      开发环境
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-1-4">
        开发环境
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/base/pythonEnv/" title="环境" class="md-nav__link">
      环境
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      爬虫
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        爬虫
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/scrapy/scrapyBase/" title="爬虫基础" class="md-nav__link">
      爬虫基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/scrapy/scrapylib/" title="爬虫库" class="md-nav__link">
      爬虫库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/scrapy/spiderdemo/" title="爬虫实战" class="md-nav__link">
      爬虫实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      服务器开发
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        服务器开发
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3-1" type="checkbox" id="nav-5-3-1">
    
    <label class="md-nav__link" for="nav-5-3-1">
      WEB
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-3-1">
        WEB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/pythonweb/" title="主流服务器介绍" class="md-nav__link">
      主流服务器介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/serverbase/" title="服务器常用软件" class="md-nav__link">
      服务器常用软件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/pythonOauth/" title="Oauth2服务器搭建" class="md-nav__link">
      Oauth2服务器搭建
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3-2" type="checkbox" id="nav-5-3-2">
    
    <label class="md-nav__link" for="nav-5-3-2">
      aws
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-3-2">
        aws
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/aws/pyaws/" title="AWSpython使用" class="md-nav__link">
      AWSpython使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/aws/serverless/" title="无服务" class="md-nav__link">
      无服务
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3-3" type="checkbox" id="nav-5-3-3">
    
    <label class="md-nav__link" for="nav-5-3-3">
      Django开发
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-3-3">
        Django开发
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/djangosignals/" title="Dajngo信号机制" class="md-nav__link">
      Dajngo信号机制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/djangoLogger/" title="日志配置" class="md-nav__link">
      日志配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/djangosignals/" title="Djangomessage" class="md-nav__link">
      Djangomessage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/JSONEncoder/" title="JsonEncoder" class="md-nav__link">
      JsonEncoder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/middleware/" title="中间件" class="md-nav__link">
      中间件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/django/question/" title="常见问题" class="md-nav__link">
      常见问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3-4" type="checkbox" id="nav-5-3-4">
    
    <label class="md-nav__link" for="nav-5-3-4">
      部署
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-3-4">
        部署
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/server/zappa/" title="zappa" class="md-nav__link">
      zappa
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pythonTools/" title="开发工具" class="md-nav__link">
      开发工具
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      IoT
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        IoT
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/Alexa/" title="Alexa" class="md-nav__link">
      Alexa
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/awsiot/" title="AWSIOT" class="md-nav__link">
      AWSIOT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/iotCore/" title="IotCore" class="md-nav__link">
      IotCore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/program/" title="program" class="md-nav__link">
      program
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/protocol/" title="protocol" class="md-nav__link">
      protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/usermanager/" title="UserManager" class="md-nav__link">
      UserManager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../iot/developerTools/" title="aws开发工具" class="md-nav__link">
      aws开发工具
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Secret
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Secret
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../secret/reousrce/" title="安全" class="md-nav__link">
      安全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/networktools/" title="端口扫描工具" class="md-nav__link">
      端口扫描工具
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../linux/resource/" title="资料" class="md-nav__link">
      资料
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Shell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Shell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../shell/shellresource/" title="Shell" class="md-nav__link">
      Shell
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/admonition/" title="AndroidStudio" class="md-nav__link">
      AndroidStudio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/atom/" title="Atom" class="md-nav__link">
      Atom
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/vim/" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/metadata/" title="Chrome" class="md-nav__link">
      Chrome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/markdown/" title="Markdown" class="md-nav__link">
      Markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/material/" title="Material for MkDocs" class="md-nav__link">
      Material for MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/VSCode/" title="VSCode" class="md-nav__link">
      VSCode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/datareporting/" title="数据分析" class="md-nav__link">
      数据分析
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../download/download/" title="download" class="md-nav__link">
      download
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="引擎绘制原理" class="md-nav__link">
    引擎绘制原理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="大象装进冰箱里" class="md-nav__link">
    大象装进冰箱里
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo" title="官方Demo" class="md-nav__link">
    官方Demo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo_1" title="官方Demo 源码" class="md-nav__link">
    官方Demo 源码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flutter" title="Flutter架构" class="md-nav__link">
    Flutter架构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" title="核心问题点" class="md-nav__link">
    核心问题点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="输出的渲染对象" class="md-nav__link">
    输出的渲染对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderobjectelement" title="RenderObject和Element关系" class="md-nav__link">
    RenderObject和Element关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderobjecttowidgetadapter" title="RenderObjectToWidgetAdapter的构造函数中的参数冲那里来的？" class="md-nav__link">
    RenderObjectToWidgetAdapter的构造函数中的参数冲那里来的？
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#renderview" title="renderView对象" class="md-nav__link">
    renderView对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildowner" title="BuildOwner：" class="md-nav__link">
    BuildOwner：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reassemble" title="reassemble：" class="md-nav__link">
    reassemble：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildscope" title="buildScope：" class="md-nav__link">
    buildScope：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#widget" title="初始化Widget" class="md-nav__link">
    初始化Widget
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#element" title="初始化Element" class="md-nav__link">
    初始化Element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" title="是否创建节点的核心算法:" class="md-nav__link">
    是否创建节点的核心算法:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inflatewidget-element" title="inflateWidget 真正创建Element的地方" class="md-nav__link">
    inflateWidget 真正创建Element的地方
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="绘制第一帧" class="md-nav__link">
    绘制第一帧
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipeline" title="Pipeline" class="md-nav__link">
    Pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipeline_1" title="pipeline" class="md-nav__link">
    pipeline
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flushlayout" title="flushLayout" class="md-nav__link">
    flushLayout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushcompositingbits" title="flushCompositingBits" class="md-nav__link">
    flushCompositingBits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushpaint" title="flushPaint" class="md-nav__link">
    flushPaint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#renderviewcompositeframe" title="renderView.compositeFrame()" class="md-nav__link">
    renderView.compositeFrame()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="如何计算渲染对象的摆放位置和自定义控件" class="md-nav__link">
    如何计算渲染对象的摆放位置和自定义控件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="flutter-widget">Flutter Widget初始化<a class="headerlink" href="#flutter-widget" title="Permanent link">&para;</a></h1>
<h2 id="_1">引擎绘制原理<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>在分析FlutterUI框架之前，先来分析一下Flutter引擎是怎么用最少步骤把一帧绘制在屏幕上的</p>
<h3 id="_2">大象装进冰箱里<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>1.Flutter启动时调用scheduleFrame()会触发ui.window.onBeginFrame()回调方法调用</p>
<p>2.sceneBuilder 生成场景</p>
<p>3.数据回传到渲染引擎:ui.window.render(scene);</p>
<p>4.手势回调事件:ui.window.onPointerDataPacket = handlePointerDataPacket;，通过手势事件来触发不断的调用第三步骤中的方法</p>
<p>5.刷新一帧:ui.window.scheduleFrame();</p>
<p>通过上面的三个步骤，就可以实现一帧一帧的绘制的屏幕上，主要的一个内容是如何管理<code>Scene</code>对象的数据变化处理逻辑，不断的更新数据回传到渲染引擎进行计算</p>
<h3 id="demo">官方Demo<a class="headerlink" href="#demo" title="Permanent link">&para;</a></h3>
<p><img alt="pic" src="../img/WechatIMG2.jpeg" /></p>
<h3 id="demo_1">官方Demo 源码<a class="headerlink" href="#demo_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="n">ui</span><span class="p">.</span><span class="n">Picture</span> <span class="n">paint</span><span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">Rect</span> <span class="n">paintBounds</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">PictureRecorder</span> <span class="n">recorder</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">PictureRecorder</span><span class="p">();</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">recorder</span><span class="p">,</span> <span class="n">paintBounds</span><span class="p">);</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Size</span> <span class="n">size</span> <span class="o">=</span> <span class="n">paintBounds</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
  <span class="n">canvas</span><span class="p">.</span><span class="n">drawCircle</span><span class="p">(</span>
    <span class="n">size</span><span class="p">.</span><span class="n">center</span><span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">zero</span><span class="p">),</span>
    <span class="n">size</span><span class="p">.</span><span class="n">shortestSide</span> <span class="o">*</span> <span class="m">0.45</span><span class="p">,</span>
    <span class="n">ui</span><span class="p">.</span><span class="n">Paint</span><span class="p">()..</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="n">recorder</span><span class="p">.</span><span class="n">endRecording</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">ui</span><span class="p">.</span><span class="n">Scene</span> <span class="n">composite</span><span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">Picture</span> <span class="n">picture</span><span class="p">,</span> <span class="n">ui</span><span class="p">.</span><span class="n">Rect</span> <span class="n">paintBounds</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">double</span> <span class="n">devicePixelRatio</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">devicePixelRatio</span><span class="p">;</span>
  <span class="kd">final</span> <span class="n">Float64List</span> <span class="n">deviceTransform</span> <span class="o">=</span> <span class="n">Float64List</span><span class="p">(</span><span class="m">16</span><span class="p">)</span>
    <span class="p">..[</span><span class="m">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">devicePixelRatio</span>
    <span class="p">..[</span><span class="m">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">devicePixelRatio</span>
    <span class="p">..[</span><span class="m">10</span><span class="p">]</span> <span class="o">=</span> <span class="m">1.0</span>
    <span class="p">..[</span><span class="m">15</span><span class="p">]</span> <span class="o">=</span> <span class="m">1.0</span><span class="p">;</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">SceneBuilder</span> <span class="n">sceneBuilder</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">SceneBuilder</span><span class="p">()</span>
    <span class="p">..</span><span class="n">pushTransform</span><span class="p">(</span><span class="n">deviceTransform</span><span class="p">)</span>
    <span class="p">..</span><span class="n">addPicture</span><span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">picture</span><span class="p">)</span>
    <span class="p">..</span><span class="n">pop</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">sceneBuilder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">beginFrame</span><span class="p">(</span><span class="n">Duration</span> <span class="n">timeStamp</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Rect</span> <span class="n">paintBounds</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">zero</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">physicalSize</span> <span class="o">/</span> <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">devicePixelRatio</span><span class="p">);</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Picture</span> <span class="n">picture</span> <span class="o">=</span> <span class="n">paint</span><span class="p">(</span><span class="n">paintBounds</span><span class="p">);</span>
  <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Scene</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">composite</span><span class="p">(</span><span class="n">picture</span><span class="p">,</span> <span class="n">paintBounds</span><span class="p">);</span>
  <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">handlePointerDataPacket</span><span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">PointerDataPacket</span> <span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">ui</span><span class="p">.</span><span class="n">PointerData</span> <span class="n">datum</span> <span class="k">in</span> <span class="n">packet</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">datum</span><span class="p">.</span><span class="n">change</span> <span class="o">==</span> <span class="n">ui</span><span class="p">.</span><span class="n">PointerChange</span><span class="p">.</span><span class="n">down</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">color</span> <span class="o">=</span> <span class="kd">const</span> <span class="n">ui</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0xFF0000FF</span><span class="p">);</span>
      <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">scheduleFrame</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">datum</span><span class="p">.</span><span class="n">change</span> <span class="o">==</span> <span class="n">ui</span><span class="p">.</span><span class="n">PointerChange</span><span class="p">.</span><span class="n">up</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">color</span> <span class="o">=</span> <span class="kd">const</span> <span class="n">ui</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0xFF00FF00</span><span class="p">);</span>
      <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">scheduleFrame</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">color</span> <span class="o">=</span> <span class="kd">const</span> <span class="n">ui</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0xFF00FF00</span><span class="p">);</span>
  <span class="c1">// The engine calls onBeginFrame whenever it wants us to produce a frame.</span>
  <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">onBeginFrame</span> <span class="o">=</span> <span class="n">beginFrame</span><span class="p">;</span>
  <span class="c1">// The engine calls onPointerDataPacket whenever it had updated information</span>
  <span class="c1">// about the pointers directed at our app.</span>
  <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">onPointerDataPacket</span> <span class="o">=</span> <span class="n">handlePointerDataPacket</span><span class="p">;</span>
  <span class="c1">// Here we kick off the whole process by asking the engine to schedule a new</span>
  <span class="c1">// frame. The engine will eventually call onBeginFrame when it is time for us</span>
  <span class="c1">// to actually produce the frame.</span>
  <span class="n">ui</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">scheduleFrame</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h2 id="flutter">Flutter架构<a class="headerlink" href="#flutter" title="Permanent link">&para;</a></h2>
<h3 id="_3">核心问题点<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>通过上面的分析，我们知道Flutter引擎对UI层的绘制，最关心的是:</p>
<p>1.输出的渲染对象</p>
<p>2.渲染对象如何改变</p>
<p>3.如何管理渲染对象的生成</p>
<p>4.如何管理树中对象的变化</p>
<p><img alt="pic" src="../img/tree.png" /></p>
<h3 id="_4">输出的渲染对象<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>Flutter 层UI初始化过程，是在入口文件中调用<code>runApp</code>把应用Widget和系统的渲染引擎进行关联</p>
<p><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">runApp</span><span class="p">(</span><span class="n">Widget</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">WidgetsFlutterBinding</span><span class="p">.</span><span class="n">ensureInitialized</span><span class="p">()</span>
    <span class="p">..</span><span class="n">attachRootWidget</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="p">..</span><span class="n">scheduleWarmUpFrame</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
上一篇文章中，我们已经介绍了Window事件是如何分解到不同的"BaseBind"对象的子类上，并进行初始化的，继续分析用户层的widget如何和系统成的Window框架进行关联的。</p>
<p><code>attachRootWidget</code>完成了RenderObject和Element进行绑定，同时调用<code>BuilderOwer</code>来对屏幕上显示的区域和那些需要进行重新绘制的<code>Widget</code>计算。</p>
<p><code>scheduleWarmUpFrame</code>所有的数据准备好了之后，需要把一帧的数据传递到系统FlutterEngine中继续渲染出来发展屏幕上。<code>pipeline</code>是对已经计算好的数据进行处理提交到FluuterEngine上进行渲染</p>
<p>以上逻辑主要做了两个操作:</p>
<div class="codehilite"><pre><span></span>生成静态数据的关联对象:(只是保存一下逻辑数据)

1:RenderView:对应系统层渲染框架的Surface对象的数据抽象

2.Element: Widget的实例对象，Widget保存了控制自身的数据结构类型，Element对象是对是Widget的一个抽象表示，用在告诉BuilderOwer如何配置Widget，Element的生命周期_ElementLifecycle {initial,active,inactive,defunct,},调用`attachRenderObject`把渲染对象挂载到渲染树中

3.RenderObject:通过子类`RenderBox`对Element进行笛卡尔或者极坐标进行逻辑布局的坐标系，提供绘图层的Layer

4.BuildContext:提供了一个用户在Widget访问`RenderObject`的接口类

5.RenderObjectToWidgetAdapter：`RootRenderObjectElement`和`RenderView`管理在一起，根`RootRenderObjectElement`持有`RenderView`对象，那么在Element和RenderObject对象就构成了一个整体，可以同步更新数据

6.ParentData：用来在`RenderObject`中对保存数据，Widget是不可以被修改的，在Widget改变的时候，指定UI进行更新，把数据保存在`RenderObject`中，rebuild之后`RenderObject`对象还存在，除非保存数据的父节点不移除构建树中。

7.RenderObject-&amp;gt;Constraints描述子wiget能够读取的数据，不描述笛卡尔坐标系和极坐标
</pre></div>


<p>2.动态数据:</p>
<div class="codehilite"><pre><span></span>1.buildOwner:从`RenderView`开始计算整个UI树中显示的是那一部分已经是哪一部分是需要更新，保存相关的`List&amp;lt;Element&amp;gt;`对象

2.[PipelineOwner](../flutterdev/FlutterWidgetinit/#pipeline):每一个`Element`中都会有一个`RenderObject`，主要使用来处理渲染引擎在FlutterUI层的逻辑数据,上一步已经把需要更新的数据添加到`List&amp;lt;RenderObject&amp;gt;`

3.调用`RenderView`的`compositeFrame`方法把场景数据传递到系统渲染引擎
</pre></div>


<h3 id="renderobjectelement">RenderObject和Element关系<a class="headerlink" href="#renderobjectelement" title="Permanent link">&para;</a></h3>
<p>通过调用runApp中<code>attachRootWidget</code>把<code>Element</code>和<code>RenderObject</code>进行关联
<code>RenderObjectToWidgetAdapter</code>是<code>Widget</code>的一个子类，主要实现两个方法:</p>
<div class="codehilite"><pre><span></span>1.`createElement`
2.`createRenderObject`
</pre></div>


<p><code>createElement</code>主要的功能是对<code>Widget</code>进行管理，<code>Element</code>是Widget的一个实例对象,Elment有不同的子类型
<code>createRenderObject</code>主要功能是产生<code>RenderObject</code>的对象，主要功能是完成坐标系统的构建，对<code>Element</code>提供配置参数，实现类是<code>RenderBox</code></p>
<p>每一个<code>Element</code>对应一个<code>RenderObject</code>对象，<code>RenderObject</code>作为<code>Element</code>的成员变量进行使用</p>
<h3 id="renderobjecttowidgetadapter"><code>RenderObjectToWidgetAdapter</code>的构造函数中的参数冲那里来的？<a class="headerlink" href="#renderobjecttowidgetadapter" title="Permanent link">&para;</a></h3>
<p><code>renderView</code>: WidgetsBinding 继承 RendererBinding，在<code>RendererBinding</code>的<code>initInstances</code>方法中初始化<code>renderView</code>,系统<code>surface</code>,成员变量<code>RenderBox</code>是整个绘图的<code>Root</code>
顶层<code>RootRenderObjectElement</code>,只用顶层对象使用<code>BuildOwner</code></p>
<p><code>RenderObjectToWidgetAdapter</code> 类作为Flutter系统顶层的UI，作为用户UI和Flutter框架层的联合点
在<code>WidgetsBinding</code>中调用<code>attachRootWidget</code>进行渲染对象和Element对象进行关联,<code>RenderView</code>成为<code>RootRenderObjectElement</code>的成员变量,渲染对象和Element对象进行关联，可以同步更新UI</p>
<p>attachRootWidget 完成三件事:</p>
<p>RenderObjectToWidgetAdapter: 关联renderView和rootWidget</p>
<p>关联PipelineOwner</p>
<p>关联BuildOwner</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">attachRootWidget</span><span class="p">(</span><span class="n">Widget</span> <span class="n">rootWidget</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">_renderViewElement</span> <span class="o">=</span> <span class="n">RenderObjectToWidgetAdapter</span><span class="o">&lt;</span><span class="n">RenderBox</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nl">container:</span> <span class="n">renderView</span><span class="p">,</span>
    <span class="nl">debugShortDescription:</span> <span class="s1">&#39;[root]&#39;</span><span class="p">,</span>
    <span class="nl">child:</span> <span class="n">rootWidget</span><span class="p">,</span>
  <span class="p">).</span><span class="n">attachToRenderTree</span><span class="p">(</span><span class="n">buildOwner</span><span class="p">,</span> <span class="n">renderViewElement</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4 id="renderview">renderView对象<a class="headerlink" href="#renderview" title="Permanent link">&para;</a></h4>
<p>renderView对象是在<code>RendererBinding</code>中调用<code>initRenderView</code>对象进行初始化的，<code>RenderView</code>集成<code>RenderObject</code>实现<code>RenderObjectWithChildMixin</code></p>
<p>RenderBox:是真正的渲染对象
RenderObject:
  1.主要是保存RenderBox的数据实际数据和child的Constraints关系，同时保存对RenderBox操作的接口</p>
<p>2.保存和Child相关关联的数据ParentData</p>
<div class="codehilite"><pre><span></span><span class="c1">/// Creates a [RenderView] object to be the root of the</span>
<span class="c1">/// [RenderObject] rendering tree, and initializes it so that it</span>
<span class="c1">/// will be rendered when the engine is next ready to display a</span>
<span class="c1">/// frame.</span>
<span class="c1">///</span>
<span class="c1">/// Called automatically when the binding is created.</span>
<span class="kt">void</span> <span class="n">initRenderView</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">renderView</span> <span class="o">==</span> <span class="kc">null</span><span class="p">);</span>
  <span class="n">renderView</span> <span class="o">=</span> <span class="n">RenderView</span><span class="p">(</span><span class="nl">configuration:</span> <span class="n">createViewConfiguration</span><span class="p">(),</span> <span class="nl">window:</span> <span class="n">window</span><span class="p">);</span>
  <span class="n">renderView</span><span class="p">.</span><span class="n">scheduleInitialFrame</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>通过上面的初始化过程已经把渲染对象初始化完成，并且关联自己到PipelineOwner对象中，详细的信息在后续介绍(owner._nodesNeedingLayout.add(this);)</p>
<h4 id="buildowner">BuildOwner：<a class="headerlink" href="#buildowner" title="Permanent link">&para;</a></h4>
<p>widgets框架的manager类。此类跟踪需要重建的小部件，并处理其他任务作为一个整体应用于小部件树，例如管理非活动元素列出树并在必要时触发“重新组合”命令调试时热重新加载。main build owner通常由[widgetsbinding]拥有，并且是与build/layout/paint管道。可以生成其他生成所有者来管理屏幕外小部件树。若要将生成所有者分配给树，请使用的根元素上的[rootrenderobjectelement.assignowner]方法。</p>
<p>BuildOwner: 主要是查找PipelineOwner中记录的那些需要改变的渲染对象进行渲染，<code>查找有哪些</code>Element<code>是污染了，需要进行从新布局和绘制的</code></p>
<p>进行提取=======================</p>
<h4 id="reassemble">reassemble：<a class="headerlink" href="#reassemble" title="Permanent link">&para;</a></h4>
<p>使根在给定[element]的整个子树完全重建。当应用程序代码已更改并正在热重新加载，以使小部件树获取任何更改了实现。这很昂贵，除非在开发期间，否则不应该调用它。
RendererBinding的initInstances方法中调用<code>drawFrame</code></p>
<h4 id="buildscope">buildScope：<a class="headerlink" href="#buildscope" title="Permanent link">&para;</a></h4>
<p>查找在屏幕上显示的区域的Element,确定哪些元素是要进行处理，画布是一个没有边界的区域，所以在在绘制之前是需要进行确认哪些区域是需要进行处理的
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">drawFrame</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">.....</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">renderViewElement</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="c1">///开始计算在屏幕上显示一帧的范围</span>
      <span class="n">buildOwner</span><span class="p">.</span><span class="n">buildScope</span><span class="p">(</span><span class="n">renderViewElement</span><span class="p">);</span>
    <span class="k">super</span><span class="p">.</span><span class="n">drawFrame</span><span class="p">();</span>
    <span class="n">buildOwner</span><span class="p">.</span><span class="n">finalizeTree</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="err">。。。。。。</span>
  <span class="p">}</span>
  <span class="p">.......</span>
<span class="p">}</span>
</pre></div></p>
<h2 id="widget">初始化<code>Widget</code><a class="headerlink" href="#widget" title="Permanent link">&para;</a></h2>
<p>上面介绍了初始化系统框架成的渲染对象<code>renderView</code>,和记录Widget变化信息的<code>PipelineOwner</code>,真正执行测量、布局、绘制、的整个过程，并且已经初始化不同的BaseBind对象的子类，分解了Window对象的事件</p>
<p><code>RenderObjectToWidgetAdapter.attachToRenderTree</code>对Element进行创建
将这个Widget进行填充，并实际将结果[renderobject]设置为[容器]的子级。如果element为空，则此函数将创建一个新元素。否则，给定元素将有一个计划好的更新以切换到此小部件。由[runapp]用于引导应用程序。
 Only one [buildScope] can be active at a time.</p>
<div class="codehilite"><pre><span></span><span class="n">RenderObjectToWidgetElement</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">attachToRenderTree</span><span class="p">(</span><span class="n">BuildOwner</span> <span class="n">owner</span><span class="p">,</span> <span class="p">[</span> <span class="n">RenderObjectToWidgetElement</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">element</span> <span class="p">])</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">owner</span><span class="p">.</span><span class="n">lockState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">element</span> <span class="o">=</span> <span class="n">createElement</span><span class="p">();</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">element</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
      <span class="n">element</span><span class="p">.</span><span class="n">assignOwner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="n">owner</span><span class="p">.</span><span class="n">buildScope</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">element</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">element</span><span class="p">.</span><span class="n">_newWidget</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="n">element</span><span class="p">.</span><span class="n">markNeedsBuild</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">element</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">@</span><span class="n">override</span>
<span class="kt">String</span> <span class="n">toStringShort</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="n">debugShortDescription</span> <span class="o">??</span> <span class="k">super</span><span class="p">.</span><span class="n">toStringShort</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>渲染RenderObject到RenderObjectToWidgetElement</p>
<p>在上一步中调用<code>mount</code>方法进行静态数据的处理操作
核心步骤:主要是在树中使用，遍历整棵树对每一个节点进行处理</p>
<h4 id="element">初始化Element<a class="headerlink" href="#element" title="Permanent link">&para;</a></h4>
<p>在绑定渲染对象和跟Element之后进行，开始初始化Element对象
<div class="codehilite"><pre><span></span><span class="n">RenderObjectToWidgetElement</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">attachToRenderTree</span><span class="p">(</span><span class="n">BuildOwner</span> <span class="n">owner</span><span class="p">,</span> <span class="p">[</span> <span class="n">RenderObjectToWidgetElement</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">element</span> <span class="p">])</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span><span class="c1">///顶级原生出手动调用createment(); RenderObjectToWidgetElement</span>
    <span class="n">owner</span><span class="p">.</span><span class="n">lockState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">element</span> <span class="o">=</span> <span class="n">createElement</span><span class="p">();</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">element</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
      <span class="n">element</span><span class="p">.</span><span class="n">assignOwner</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="n">owner</span><span class="p">.</span><span class="n">buildScope</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">element</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>  <span class="c1">///开始遍历树处理每一个Widget</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">element</span><span class="p">.</span><span class="n">_newWidget</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="n">element</span><span class="p">.</span><span class="n">markNeedsBuild</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">element</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></p>
<h5 id="_5">是否创建节点的核心算法:<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>/// The following table summarizes the above:
///
/// |                     | **newWidget == null**  | **newWidget != null**   |
/// | :-----------------: | :--------------------- | :---------------------- |
/// |  **child == null**  |  Returns null.         |  Returns new [Element]. |
/// |  **child != null**  |  Old child is removed, returns null. | Old child updated if possible, returns child or new [Element]. |
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">Element</span> <span class="n">updateChild</span><span class="p">(</span><span class="n">Element</span> <span class="n">child</span><span class="p">,</span> <span class="n">Widget</span> <span class="n">newWidget</span><span class="p">,</span> <span class="kt">dynamic</span> <span class="n">newSlot</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">assert</span><span class="p">(()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">newWidget</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">newWidget</span><span class="p">.</span><span class="n">key</span> <span class="k">is</span> <span class="n">GlobalKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">GlobalKey</span> <span class="n">key</span> <span class="o">=</span> <span class="n">newWidget</span><span class="p">.</span><span class="n">key</span><span class="p">;</span>
      <span class="n">key</span><span class="p">.</span><span class="n">_debugReserveFor</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}());</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">newWidget</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">deactivateChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">widget</span> <span class="o">==</span> <span class="n">newWidget</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">slot</span> <span class="o">!=</span> <span class="n">newSlot</span><span class="p">)</span>
        <span class="n">updateSlotForChild</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">child</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Widget</span><span class="p">.</span><span class="n">canUpdate</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">widget</span><span class="p">,</span> <span class="n">newWidget</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">slot</span> <span class="o">!=</span> <span class="n">newSlot</span><span class="p">)</span>
        <span class="n">updateSlotForChild</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
      <span class="n">child</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">newWidget</span><span class="p">);</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">widget</span> <span class="o">==</span> <span class="n">newWidget</span><span class="p">);</span>
      <span class="k">assert</span><span class="p">(()</span> <span class="p">{</span>
        <span class="n">child</span><span class="p">.</span><span class="n">owner</span><span class="p">.</span><span class="n">_debugElementWasRebuilt</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}());</span>
      <span class="k">return</span> <span class="n">child</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">deactivateChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">_parent</span> <span class="o">==</span> <span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">inflateWidget</span><span class="p">(</span><span class="n">newWidget</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h5 id="inflatewidget-element">inflateWidget 真正创建Element的地方<a class="headerlink" href="#inflatewidget-element" title="Permanent link">&para;</a></h5>
<p>//为给定的小部件创建一个元素，并将其添加为给定槽中的元素。此方法通常由[updatechild]调用，但可以调用直接通过需要对创建进行更细粒度控制的子类元素。
如果给定的小部件有一个全局键并且已经存在一个元素具有具有该全局键的小部件，此函数将重用该元素可能从树上的另一个位置嫁接或重新激活(it from the list of inactive elements）而不是创建一个新元素。
此函数返回的元素已经被装入将处于活动生命周期状态。注:以上是对UI架构中使用到的逻辑继续分析，主要是把整个UI框架的数据表示和关联进行拆分和组合，能够提供UI变化是数据的跟踪和记录(静态数据保存逻辑)</p>
<p><code>final Element newChild = newWidget.createElement();</code>遍历树，为每一个Widget生成实例对象<code>Element</code>,调用<code>mount</code>方法把<code>Elment</code>添加到树中</p>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">protected</span>
<span class="n">Element</span> <span class="n">inflateWidget</span><span class="p">(</span><span class="n">Widget</span> <span class="n">newWidget</span><span class="p">,</span> <span class="kt">dynamic</span> <span class="n">newSlot</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">newWidget</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
  <span class="kd">final</span> <span class="n">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">newWidget</span><span class="p">.</span><span class="n">key</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="k">is</span> <span class="n">GlobalKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">Element</span> <span class="n">newChild</span> <span class="o">=</span> <span class="n">_retakeInactiveElement</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">newWidget</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">newChild</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">newChild</span><span class="p">.</span><span class="n">_parent</span> <span class="o">==</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">assert</span><span class="p">(()</span> <span class="p">{</span> <span class="n">_debugCheckForCycles</span><span class="p">(</span><span class="n">newChild</span><span class="p">);</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}());</span>
      <span class="n">newChild</span><span class="p">.</span><span class="n">_activateWithParent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
      <span class="kd">final</span> <span class="n">Element</span> <span class="n">updatedChild</span> <span class="o">=</span> <span class="n">updateChild</span><span class="p">(</span><span class="n">newChild</span><span class="p">,</span> <span class="n">newWidget</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">newChild</span> <span class="o">==</span> <span class="n">updatedChild</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">updatedChild</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">final</span> <span class="n">Element</span> <span class="n">newChild</span> <span class="o">=</span> <span class="n">newWidget</span><span class="p">.</span><span class="n">createElement</span><span class="p">();</span>
  <span class="k">assert</span><span class="p">(()</span> <span class="p">{</span> <span class="n">_debugCheckForCycles</span><span class="p">(</span><span class="n">newChild</span><span class="p">);</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}());</span>
  <span class="n">newChild</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">newSlot</span><span class="p">);</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">newChild</span><span class="p">.</span><span class="n">_debugLifecycleState</span> <span class="o">==</span> <span class="n">_ElementLifecycle</span><span class="p">.</span><span class="n">active</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">newChild</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4 id="_6">绘制第一帧<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>触发第一帧尽快执行，而不是等待引擎请求帧以响应系统“vsync”信号。这在应用程序启动期间使用，以便第一个帧（即可能很贵）得到一些额外的毫秒来运行。锁定事件调度，直到调度的帧完成。
如果已经用[scheduleFrame]计划了一个帧，或者[scheduleForcedFrame]，此调用可能会延迟该帧。
如果任何计划的帧已经开始，或者如果另一个已经调用了[schedulewarmupframe]，此调用将被忽略。prefer[scheduleframe]在正常操作中更新显示。
调用<code>scheduleFrame</code>触发window对象处理第一帧数据<code>window.scheduleFrame();</code>,将会触发<code>window.onBeginFrame</code>,开始执行，<code>SchedulerBinding</code>负责处理window对象的frame回调事件</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">scheduleWarmUpFrame</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">_warmUpFrame</span> <span class="o">||</span> <span class="n">schedulerPhase</span> <span class="o">!=</span> <span class="n">SchedulerPhase</span><span class="p">.</span><span class="n">idle</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="n">_warmUpFrame</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="n">Timeline</span><span class="p">.</span><span class="n">startSync</span><span class="p">(</span><span class="s1">&#39;Warm-up frame&#39;</span><span class="p">);</span>
  <span class="kd">final</span> <span class="kt">bool</span> <span class="n">hadScheduledFrame</span> <span class="o">=</span> <span class="n">_hasScheduledFrame</span><span class="p">;</span>
  <span class="n">Timer</span><span class="p">.</span><span class="n">run</span><span class="p">(()</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_warmUpFrame</span><span class="p">);</span>
    <span class="n">handleBeginFrame</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="n">Timer</span><span class="p">.</span><span class="n">run</span><span class="p">(()</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_warmUpFrame</span><span class="p">);</span>
    <span class="n">handleDrawFrame</span><span class="p">();</span>
    <span class="n">resetEpoch</span><span class="p">();</span>
    <span class="n">_warmUpFrame</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hadScheduledFrame</span><span class="p">)</span>
      <span class="n">scheduleFrame</span><span class="p">();</span>
  <span class="p">});</span>
  <span class="n">lockEvents</span><span class="p">(()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">await</span> <span class="n">endOfFrame</span><span class="p">;</span>
    <span class="n">Timeline</span><span class="p">.</span><span class="n">finishSync</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>在<code>RendererBinding</code>初始化<code>initInstances</code>时，<code>addPersistentFrameCallback</code>添加处理一帧的回调函数<code>_handlePersistentFrameCallback</code>,一下方法很简单，上一步中调用<code>scheduleFrame()</code>触发<code>window.onDrawFrame</code>回调函数执行</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">_handlePersistentFrameCallback</span><span class="p">(</span><span class="n">Duration</span> <span class="n">timeStamp</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">drawFrame</span><span class="p">();</span>
  <span class="p">}</span>
</pre></div>

<h4 id="pipeline">Pipeline<a class="headerlink" href="#pipeline" title="Permanent link">&para;</a></h4>
<h3 id="pipeline_1">pipeline<a class="headerlink" href="#pipeline_1" title="Permanent link">&para;</a></h3>
<p>管道所有者管理呈现管道。管道所有者提供了一个接口，用于驱动呈现管道并存储已请求访问的渲染对象的状态在管道的每个阶段。要刷新管道，请调用以下命令函数顺序：</p>
<p>1.[flushlayout]更新任何需要计算其布局。在此阶段中，每个渲染的大小和位置计算对象。渲染对象可能会弄脏其绘画或此阶段的合成状态。</p>
<p>2.[flushcompositingbits]更新任何已脏的渲染对象合成位。在此阶段中，每个渲染对象都将学习它的任何子级都需要合成。此信息用于选择如何实现视觉效果时的绘制阶段，例如剪辑。如果渲染对象有合成子对象，则需要使用[层]创建剪辑以便剪辑应用于composited child（将被绘制到它自己的[layer]）。</p>
<p>3.[flushpaint]访问任何需要绘制的渲染对象。在此期间阶段，渲染对象有机会将绘制命令记录到[PictureLayer]和构造其他合成的[Layer]s。</p>
<p>4。最后，如果启用了语义，[flushssemantics]将编译呈现对象的语义。此语义信息由提高渲染树可访问性的辅助技术。[renderBinding]保存渲染对象的管道所有者在屏幕上可见。您可以创建其他管道所有者来管理off-screen对象，它可以独立于屏幕上的渲染对象。</p>
<p>pipeline是在什么时候开始调用的？？
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">runApp</span><span class="p">(</span><span class="n">Widget</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">WidgetsFlutterBinding</span><span class="p">.</span><span class="n">ensureInitialized</span><span class="p">()</span>
    <span class="p">..</span><span class="n">attachRootWidget</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="p">..</span><span class="n">scheduleWarmUpFrame</span><span class="p">();</span>
<span class="p">}</span>
</pre></div></p>
<p>此方法由[handleDrawFrame]调用，它本身被调用在布局和绘制框架时由引擎自动执行。每个帧由以下阶段组成：</p>
<p>1.动画阶段：注册的[handlebeginframe]方法with[window.onbeginframe]，调用所有临时帧回调按注册顺序向[scheduleFrameCallback]注册。这个包含正在驱动的所有实例objects，这意味着所有活动的[animation]对象点。</p>
<p>2.Microtasks：在[handlebeginframe]返回后，任何由临时帧回调安排的运行。这通常包括[ticker]和[animationcontroller]的期货回调完成此帧。在[handlebeginframe]之后，[handledrawframe]，注册于调用了[window.onDrawFrame]，它调用所有的持久帧callbacks，其中最值得注意的是这个方法，[drawFrame]，它</p>
<p>3.布局阶段：系统中所有脏的[renderobject]都被放置out（参见[renderObject.performlayout]）。参见[renderobject.markneedslayout]有关将对象标记为脏的布局的详细信息。</p>
<p>4.合成位阶段：任何脏文件上的合成位[renderObject]对象已更新。湖[renderObject.markneedscompositingbitsupdate]。</p>
<p>5.绘制阶段：系统中所有脏的[renderobject]都是重新绘制（参见[renderobject.paint]）。这将生成[层]树。湖[renderbject.markneedspaint]了解有关标记对象的详细信息油漆脏了。</p>
<p>6.合成阶段：图层树变成一个场景发送到GPU。7。语义阶段：系统中所有脏的[renderobject]都有它们的语义已更新（请参见[renderobject.semanticsannotator]）。这个生成[semanticsnode]树。湖[renderbject.markneedssemanticsupdate]了解有关标记语义的脏对象。有关步骤3-7的更多详细信息，请参见[PipelineOwner]。</p>
<p>8.定稿阶段：在[DrawFrame]返回后，[HandleDrawFrame]然后调用后帧回调（使用[addPostFrameCallback]注册）。一些绑定（例如，[widgetsbinding]）为此添加了额外的步骤list（例如，请参见[widgetsbinding.drawframe]）。</p>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">protected</span>
<span class="kt">void</span> <span class="n">drawFrame</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">assert</span><span class="p">(</span><span class="n">renderView</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
  <span class="n">pipelineOwner</span><span class="p">.</span><span class="n">flushLayout</span><span class="p">();</span>
  <span class="n">pipelineOwner</span><span class="p">.</span><span class="n">flushCompositingBits</span><span class="p">();</span>
  <span class="n">pipelineOwner</span><span class="p">.</span><span class="n">flushPaint</span><span class="p">();</span>
  <span class="n">renderView</span><span class="p">.</span><span class="n">compositeFrame</span><span class="p">();</span> <span class="c1">// this sends the bits to the GPU</span>
  <span class="n">pipelineOwner</span><span class="p">.</span><span class="n">flushSemantics</span><span class="p">();</span> <span class="c1">// this also sends the semantics to the OS.</span>
<span class="p">}</span>
</pre></div>

<h5 id="flushlayout">flushLayout<a class="headerlink" href="#flushlayout" title="Permanent link">&para;</a></h5>
<p>BuildOwner在执行的过程中把需要会在的<code>RenderObject</code>对象查找出来保存在<code>_nodesNeedingLayout</code>列表中，通过树的深度来进行排序遍历，调用<code>_layoutWithoutResize</code>方法进行布局大小的改变，同时把需要绘制的<code>RenderObject</code>添加到<code>_nodesNeedingPaint</code>集合中便于下一个阶段进行绘制，改变<code>_needsPaint</code>为true</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">flushLayout</span><span class="p">()</span> <span class="p">{</span>
<span class="p">....</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// TODO(ianh): assert that we&#39;re not allowing previously dirty nodes to redirty themselves</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">_nodesNeedingLayout</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RenderObject</span><span class="o">&gt;</span> <span class="n">dirtyNodes</span> <span class="o">=</span> <span class="n">_nodesNeedingLayout</span><span class="p">;</span>
      <span class="n">_nodesNeedingLayout</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">RenderObject</span><span class="o">&gt;</span><span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">RenderObject</span> <span class="n">node</span> <span class="k">in</span> <span class="n">dirtyNodes</span><span class="p">..</span><span class="n">sort</span><span class="p">((</span><span class="n">RenderObject</span> <span class="n">a</span><span class="p">,</span> <span class="n">RenderObject</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">depth</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">depth</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">_needsLayout</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="k">this</span><span class="p">)</span>
          <span class="n">node</span><span class="p">.</span><span class="n">_layoutWithoutResize</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h5 id="flushcompositingbits"><code>flushCompositingBits</code><a class="headerlink" href="#flushcompositingbits" title="Permanent link">&para;</a></h5>
<p>上一步中把相关的位置大小确认好之后，如果有多个控件有重叠的部分，需要进行合并,如何调用<code>markNeedsPaint</code>准备后续需要汇总的内容
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">flushCompositingBits</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kReleaseMode</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Timeline</span><span class="p">.</span><span class="n">startSync</span><span class="p">(</span><span class="s1">&#39;Compositing bits&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">_nodesNeedingCompositingBitsUpdate</span><span class="p">.</span><span class="n">sort</span><span class="p">((</span><span class="n">RenderObject</span> <span class="n">a</span><span class="p">,</span> <span class="n">RenderObject</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">depth</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">depth</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">RenderObject</span> <span class="n">node</span> <span class="k">in</span> <span class="n">_nodesNeedingCompositingBitsUpdate</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">_needsCompositingBitsUpdate</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="k">this</span><span class="p">)</span>
      <span class="n">node</span><span class="p">.</span><span class="n">_updateCompositingBits</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">_nodesNeedingCompositingBitsUpdate</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kReleaseMode</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Timeline</span><span class="p">.</span><span class="n">finishSync</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></p>
<h5 id="flushpaint"><code>flushPaint</code><a class="headerlink" href="#flushpaint" title="Permanent link">&para;</a></h5>
<p>更新所有渲染对象的显示列表。此函数是渲染管道的核心阶段之一。在布局之后和重新放置场景之前进行绘制，以便场景与每个渲染对象的最新显示列表合成。有关如何使用此函数的示例，请参见[RenderBinding]。
通过布局和合成两步的计算操作，已经把需要汇总的数据计算出来，提供给画笔对象把<code>RenderObject</code>对象绘制在<code>layer</code>上，Window对象中<code>render(Scene scene)</code>就是在为此函数准备数据
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="n">flushPaint</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">.....</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RenderObject</span><span class="o">&gt;</span> <span class="n">dirtyNodes</span> <span class="o">=</span> <span class="n">_nodesNeedingPaint</span><span class="p">;</span>
    <span class="n">_nodesNeedingPaint</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">RenderObject</span><span class="o">&gt;</span><span class="p">[];</span>
    <span class="c1">// Sort the dirty nodes in reverse order (deepest first).</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">RenderObject</span> <span class="n">node</span> <span class="k">in</span> <span class="n">dirtyNodes</span><span class="p">..</span><span class="n">sort</span><span class="p">((</span><span class="n">RenderObject</span> <span class="n">a</span><span class="p">,</span> <span class="n">RenderObject</span> <span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">depth</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">depth</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">_layer</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">_needsPaint</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">_layer</span><span class="p">.</span><span class="n">attached</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">///此步骤是汇总的详细过程，发到后面在进行解析</span>
          <span class="n">PaintingContext</span><span class="p">.</span><span class="n">repaintCompositedChild</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">node</span><span class="p">.</span><span class="n">_skippedPaintingOnLayer</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_nodesNeedingPaint</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
<span class="p">......</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></p>
<h5 id="renderviewcompositeframe"><code>renderView.compositeFrame()</code><a class="headerlink" href="#renderviewcompositeframe" title="Permanent link">&para;</a></h5>
<p>上一步中已经把需要汇总的<code>RenderObject</code>进行了绘制，每一个<code>RenderObject</code>中都有一个<code>ContainerLayer</code>对象，作为每一个渲染对象的<code>Layer</code>,现在需要处理的是在Flutter已经做好了逻辑操作，需要把Dart对象转换为渲染引擎能够识别的对象:
Window对象中<code>render(Scene scene)</code>就是在为此函数准备数据，通过Navtive调用把数据传递到底层绘制
1.使用SceneBuilder对象来创建场景
2.把<code>RenderObject</code>对象中数据取出来构建Scene的原始数据
3.调用<code>_window.render(scene);</code>实现真正的数据传递到渲染引擎</p>
<div class="codehilite"><pre><span></span><span class="c1">/// Uploads the composited layer tree to the engine.</span>
<span class="c1">///</span>
<span class="c1">/// Actually causes the output of the rendering pipeline to appear on screen.</span>
<span class="kt">void</span> <span class="n">compositeFrame</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">SceneBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">SceneBuilder</span><span class="p">();</span>
    <span class="kd">final</span> <span class="n">ui</span><span class="p">.</span><span class="n">Scene</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">layer</span><span class="p">.</span><span class="n">buildScene</span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">automaticSystemUiAdjustment</span><span class="p">)</span>
      <span class="n">_updateSystemChrome</span><span class="p">();</span>
    <span class="n">_window</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>
    <span class="n">scene</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
    <span class="k">assert</span><span class="p">(()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">debugRepaintRainbowEnabled</span> <span class="o">||</span> <span class="n">debugRepaintTextRainbowEnabled</span><span class="p">)</span>
        <span class="n">debugCurrentRepaintColor</span> <span class="o">=</span> <span class="n">debugCurrentRepaintColor</span><span class="p">.</span><span class="n">withHue</span><span class="p">((</span><span class="n">debugCurrentRepaintColor</span><span class="p">.</span><span class="n">hue</span> <span class="o">+</span> <span class="m">2.0</span><span class="p">)</span> <span class="o">%</span> <span class="m">360.0</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}());</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="_7">如何计算渲染对象的摆放位置和自定义控件<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>计算此渲染对象的布局。此方法是父控件要求子控件执行的主要入口点更新他们的布局信息。父对象传递约束对象它通知子级哪些布局是允许的。这子控件是必须遵守给定的约束。如果父级读取子级布局期间计算的信息，则“parentUseSSize”的父级必须传递true。在这种情况下，父母将：只要子项被标记为需要布局，就被标记为需要布局因为父级的布局信息依赖于子级的布局信息。如果父项使用默认值（false）“parentUseSSize”，子项可以更改其布局信息（根据给定的约束）而不通知父级。子类不应直接重写[Layout]。相反，他们应该重写[PerformResize]和/或[performLayout]。delegates将实际工作委托给[performResize]和[performLayout]。父级的[Performance Layout]方法应调用其所有无条件的子项。这是[布局]方法的责任在此处实现）如果子项不需要执行任何操作，则提前返回更新其布局信息。</p>
<p><code>flushLayout</code>调用<code>node._layoutWithoutResize();</code>进行渲染对象的位置计算<code>RenderView</code>中的<code>performLayout</code>进行layout进行处理
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">override</span>
  <span class="kt">void</span> <span class="n">performLayout</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_rootTransform</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
    <span class="n">_size</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">_size</span><span class="p">.</span><span class="n">isFinite</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">child</span><span class="p">.</span><span class="n">layout</span><span class="p">(</span><span class="n">BoxConstraints</span><span class="p">.</span><span class="n">tight</span><span class="p">(</span><span class="n">_size</span><span class="p">));</span>
  <span class="p">}</span>
</pre></div></p>
<h2 id="_8">总结<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>1.通过上面的分析我们知道，Widget出现在屏幕上执行执行四个步骤就可以显示。FlutterUI框架中对Widow类进行拆分，对不同的回调事件进行不同的mixin类来进行处理</p>
<p>2.通过runApp把开发的Widget和系统框架层关联：1.Element和RenderObject对象进行绑定。2.触发系统绘制一帧</p>
<p>3.分别处理不同的实际功能<a href="../../flutter/flutterUIframework/">BindingBase</a>GestureBinding, ServicesBinding, SchedulerBinding, PaintingBinding, SemanticsBinding, RendererBinding, WidgetsBinding</p>
<p>4.通过<code>RenderObjectToWidgetAdapter</code>对象来进行Element、RenderObject对象进行关联，主要是处理Widget的数据和RenderView中的数据</p>
<p>5.Element管理Widget数据</p>
<p>6.RenderObject面向Flutter引擎接口，提供绘制UI数据的Layters</p>
<p>7.BuildContext提供了Widget中访问RenderObject对象的接口</p>
<p>8.BuildOwer主要是变量Element查找出那些Element是需要重新进行绘制的</p>
<p>9.Pipeline插座RenderObject对象，处理那些事渲染对象是需要在Layer进行Layout、填充、绘制的</p>
<p>10.调用RenderView中的方法，把生成的数据调用window.render(scene)传递到渲染引擎</p>
<p>11.RenderObject是如何摆放在正确的位置上的<a href="./EngineCompile.md">自定义控件</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../flutter/flutterUIframework/" title="FlutterUI和Engine关联" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                FlutterUI和Engine关联
              </span>
            </div>
          </a>
        
        
          <a href="../platform_channels/" title="PlatformChannel" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                PlatformChannel
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2019  Aige
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="http://struct.cc" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/cangchengkun/Docs" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/Aige25868905" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.facebook.com/cangck.danmo" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.youtube.com/" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.43ad2ac2.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>