# Android&IOS打包发布

## 概要
应用程序正在改变世界，丰富人们的生活，并使像您这样的开发人员能够前所未有地进行创新。结果，App Store已成长为一个激动人心且充满活力的生态系统，为数百万开发人员和超过10亿用户所用。无论您是第一次开发人员还是经验丰富的程序员组成的庞大团队，我们都为您正在为App Store创建应用程序而感到兴奋，并希望帮助您了解我们的指南，因此您可以确信自己的应用程序将快速通过审核过程。

## 介绍
应用市场的指导原则很简单-我们希望为用户提供获取应用程序的安全体验，并为所有开发人员取得成功提供巨大的机会。我们通过提供高度策划的应用来做到这一点，其中的每个应用程序都经过专家审查，编辑团队可以帮助用户每天发现新应用程序。对于其他所有方面，始终都有开放的Internet。如果应用市场模型和指南不适合您的应用或业务构想，那么我们也提供Safari来提供出色的Web体验。
在以下页面上，您会发现我们的最新指南分为五个清晰的部分：安全，性能，业务，设计和法律。应用市场总是在不断变化和改进，以适应我们客户和我们产品的需求。您的应用程序也应该进行更改和改进，以便保留在应用市场中。

1.安全
2.性能
3.业务
4.设计
5.法律法规(不同国家和地区)

## 确保

测试您的应用程序是否崩溃和错误
确保所有应用信息和元数据完整且准确
更新您的联系信息，以防App Review需要与您联系
提供有效的演示帐户和登录信息，以及查看您的应用程序可能需要的任何其他硬件或资源（例如，登录凭据或示例QR码）
启用后端服务，以便它们在审核期间处于活动状态并可以访问
在App Review注释中包括对非显而易见功能和应用内购买的详细说明，并在适当时包括支持文档。


UI框架:UIKit框架提供了构建用于iOS和tvOS的应用程序所需的核心对象。您可以使用这些对象在屏幕上显示您的内容，与该内容进行交互以及管理与系统的交互。应用程序依赖于UIKit的基本行为，而UIKit提供了多种方式来自定义行为以符合您的特定需求。
Xcode项目文件结构:在构建应用程序时，Xcode会编译您的源文件并为您的项目创建一个应用程序包。应用程序捆绑包是一个结构化目录，其中包含与该应用程序关联的代码和资源。资源包括支持您的代码的图像资产，情节提要文件，字符串文件和应用程序元数据。应用程序捆绑包的结构很重要，但是Xcode知道您的资源需要存放在哪里，所以暂时不必担心。


## [IOS打包](https://developer.apple.com/app-store/review/guidelines/)

我们会审查提交给AppStore的所有应用程序和应用程序更新，以确定它们是否可靠，是否达到预期效果以及是否没有令人反感的材料。在计划和开发应用程序时，请确保使用这些准则和资源。

1.规划和开发应用程序
2.是否到达预期
3.是否可靠
4.是否有让人发的内容
5.提交应用市场


### 检查您的应用是否遵循其他文档中的指导

发展方针

[应用程式设计指南](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007072)
[App Extension编程指南](https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/)
[iOS数据存储准则](https://developer.apple.com/icloud/documentation/data-storage/index.html)
[macOS文件系统文档](https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672)
[Safari应用程序扩展](https://developer.apple.com/documentation/safariservices/safari_app_extensions)
[App Store Connect帮助](https://help.apple.com/app-store-connect/)

设计准则

[人机界面准则](https://developer.apple.com/design/human-interface-guidelines/)

品牌与行销准则

[营销资源和身份准则](https://developer.apple.com/app-store/marketing/guidelines/)
[Apple Pay身份准则](https://developer.apple.com/apple-pay/marketing/)
[添加到Apple电子钱包指南](https://developer.apple.com/wallet/Add-to-Apple-Wallet-Guidelines.pdf)
[使用苹果商标和版权的准则](http://www.apple.com/legal/intellectual-property/guidelinesfor3rdparties.html)


### 开发、测试、数据统计
[Xcode Help](https://help.apple.com/xcode/mac/current/#/devc8c2a6be1)
[Apple Developer Program](https://developer.apple.com/programs/)
[测试](https://developer.apple.com/testflight/)


#### 数据统计

衡量iOS，macOS和tvOS上的应用的用户参与度，营销活动，获利等。
[Access App Analytic](https://developer.apple.com/app-store-connect/analytics/)

App Store来源
借助App Analytics，您可以查看有多少用户在搜索或浏览App Store时发现了您的应用（包括在iOS上点击适用于您的应用的Search Ads）以了解您的营销和元数据如何影响下载。

应用引荐来源
App Analytics会统计从另一个应用程序中的链接访问iOS或tvOS上您应用程序产品页面的用户。通过关注可带来最多App Store印象，下载和账单的应用来优化您的营销活动。

网络推荐人
链接到应用程序产品页面的博客，网站和其他在线资源对于通过口碑营销和PR来吸引用户至关重要。借助App Analytics，您可以查看哪些有机营销渠道为您的应用带来了最高的流量，下载量，使用量和收入。

App Store展示次数
查看您的应用程序图标在App Store上浏览了多少次，包括在搜索结果，精选，热门图表和App Store产品页面中。借助App Store展示次数，您可以计算出用户点击浏览您的应用的频率，而无需查看在App Store上的任何位置。

用户参与度
App Analytics提供了用户参与度指标，包括会话数，活动设备以及iOS和tvOS上您的应用程序的保留时间。借助这些指标，您可以评估产品更改的影响（例如修改初始的入职体验），以查看哪些更改可以改善与应用程序的互动。

删除新
查看有多少用户从运行iOS 12.3或更高版本的设备上删除了您的应用。测量“应用程序删除”，以更好地了解用户对应用程序更改（例如内容更新，价格调整或崩溃）的反应。按来源或用户组比较“应用删除”，以查看哪些类型的用户更有可能卸载您的应用。

营销活动
App Analytics可让您评估您的营销工作，以便您可以专注于最有效的广告系列。为每个营销活动创建唯一的链接，以了解哪些活动带来了最多的下载量和每个用户的平均支出。您还可以使用StoreKit API跟踪广告系列。

App Store产品页面
出色的产品页面可以吸引受众的注意力，传达您的应用价值，并说服用户下载。现在，您可以通过将下载次数与产品页面浏览量相关联来计算产品页面的效果。

付费用户
App Analytics根据Apple ID（而不是设备类型）对用户进行计数，从而使您可以更准确地了解付费用户数据。查看您一天有多少付费用户，以评估您所做的任何更改是否会影响应用程序内的支出。您还可以按来源过滤，以查看用户是否来自特定的广告系列或网站。

崩溃
找出您的应用每天在iOS或tvOS上崩溃的次数。您可以按平台，应用程序版本和操作系统版本筛选崩溃数据，以查明原因，帮助您为用户创造更好的体验。

按下载日期分类
只有Apple可以提供Apple ID首次从App Store下载应用程序的日期。您可以根据用户的购买日期过滤用户组，以在比较和分析用户行为时形成更完整的图片。

苹果电视数据
评估您的tvOS应用程序的用户参与度和获利。除了查看产品页面浏览量，下载量和参与度方面的数据外，您还可以查看通过营销活动获得的iOS用户在Apple TV上打开了同一个应用程序。*您还可以在另一个tvOS应用程序中推广tvOS应用程序，使用广告系列链接跟踪结果。

## [App Store Connect 使用入门](https://help.apple.com/app-store-connect/?lang=zh-cn#/)

App Store Connect 使用入门
添加、编辑和删除用户
管理 App 和版本
添加 App 图标、App 预览和截屏
管理构建版本
测试 Beta 版本
在 App Store 上发行
维护您的 App
衡量 App 表现
管理协议、税务和银行业务
获得付款
配置 App Store 功能
提供 App 内购买项目
参考

## Android 打包
### 测试、部署、签名、分发

Android 编译系统`会编译应用资源和源代码`，然后将它们打包成可供您测试、部署、签署和分发的 APK。Android Studio 使用高级编译工具包` Gradle` 来`自动执行和管理编译流程`，同时也允许您定义灵活的`自定义编译配置`。每个编译配置均可定义自己的一组代码和资源，同时重用所有应用版本共用的部分。Android Plugin for Gradle 与该编译工具包一起使用，共同提供专用于编译和测试 Android 应用的流程和可配置设置。

#### 编译系统:
[Gradle](http://www.gradle.org/)
[jetpack](https://developer.android.com/jetpack/docs/getting-started))

如何自动执行、如何管理打包流程、如何配置自定义编译配置
[使用命令行打包](https://developer.android.com/studio/build/building-cmdline.html)

生成编译报告

    ./gradlew --profile --offline --rerun-tasks assemblefreeDebug
查看CPU架构信息:
查看Android设备的CPU架构信息，可以使用命令来完成：
1、adb shell
2、cat  /proc/cpuinfo
[AndroidCPU其中架构](https://www.jianshu.com/p/d6750a920019)



## 打包流程

典型 Android 应用模块的编译流程（如图 1 所示）按照以下常规步骤执行：

编译器将您的源代码转换成 DEX 文件（Dalvik 可执行文件，其中包括在 Android 设备上运行的字节码），并将其他所有内容转换成编译的资源。
APK 打包器将 DEX 文件和编译的资源组合成单个 APK。不过，必须先为 APK 签名，然后才能将应用安装并部署到 Android 设备上。
APK 打包器使用调试或发布密钥库为 APK 签名：
如果您编译的是应用调试版本（即专用于测试和分析的应用），打包器会使用调试密钥库为应用签名。Android Studio 自动使用调试密钥库配置新项目。
如果您编译的是打算向外发布的应用发布版本，打包器会使用发布密钥库为应用签名。要创建发布密钥库，请参阅在 Android Studio 中为应用签名。
在生成最终 APK 之前，打包器会使用 zipalign 工具对应用进行优化，减少其在设备上运行时占用的内存。
编译流程结束时，您将获得可用于部署和测试的调试 APK，或者可用于发布给外部用户的发布 APK。





## Android Android Jetpack 使用入门
## Android打包
JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore ./key.jks -destkeystore ./key.jks -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。


Jetpack 包含一系列 Android 库，它们都采用最佳做法并在 Android 应用中提供向后兼容性。
Jetpack 应用架构指南概述了构建 Android 应用时要考虑的最佳做法和推荐架构。
下文介绍了如何开始使用 Jetpack 组件。
[Android Jetpack 使用入门](https://developer.android.com/jetpack/docs/getting-started)
[Android Jetpack组件列表](https://developer.android.com/jetpack/#foundation-components)

Android Jetpack is a set of components, tools and guidance to make great Android apps. They bring together the existing Support Library and Architecture Components and arrange them into four categories:
![pic](./flutterdev/img/androidjetpack.png)
[Android Sunflower开发源码项目](https://medium.com/androiddevelopers/introducing-android-sunflower-e421b43fe0c2)
[GithHub源码项目代码](https://github.com/android/sunflower)

## AndroidStudioMaven仓库的使用

[Google Maven](https://maven.google.com/web/index.html)
[Android Studio 使用Maven仓库](http://android-er.blogspot.com/2019/03/add-google-maven-repository-to-android.html)
[Guide to Public Maven Repositories](https://www.deps.co/guides/public-maven-repositories/#maven-central)

[Android KTX](https://developer.android.com/kotlin/ktx) 是一组 Kotlin 扩展程序，属于 Android Jetpack 系列。它优化了供 Kotlin 使用的 Jetpack 和 Android 平台 API。Android KTX 旨在让您利用 Kotlin 语言功能（例如扩展函数/属性、lambda、命名参数和参数默认值），以更简洁、更愉悦、更惯用的方式使用 Kotlin 进行 Android 开发。Android KTX 不会向现有的 Android API 添加任何新功能。
要详细了解 Android KTX，请观看我们的 [DevBytes 视频](https://www.youtube.com/watch?v=r_19VZ0xRO8&feature=youtu.be)。

## AndroidX 概述
AndroidX 是 Android 团队用于在 Jetpack 中开发、测试、打包和发布库以及对其进行版本控制的开源项目。
AndroidX 对原始 Android 支持库进行了重大改进。与支持库一样，AndroidX 与 Android 操作系统分开提供，并与各个 Android 版本向后兼容。AndroidX 完全取代了支持库，不仅提供同等的功能，而且提供了新的库。此外，AndroidX 还包括以下功能：

AndroidX 中的所有软件包都使用一致的命名空间，以字符串 androidx 开头。支持库软件包已映射到对应的 androidx.* 软件包。有关所有旧类到新类以及旧编译工件到新编译工件的完整映射，请参阅软件包重构页面。
与支持库不同，AndroidX 软件包会单独维护和更新。androidx 软件包使用严格的语义版本控制，从版本 1.0.0 开始。您可以单独更新项目中的 AndroidX 库。
所有新支持库的开发工作都将在 AndroidX 库中进行。这包括维护原始支持库工件和引入新的 Jetpack 组件。

[AndroidX 概览](https://developer.android.com/jetpack/androidx)
[迁移到AndroidX](https://developer.android.com/jetpack/androidx/migrate)
[AndroidX包列表](https://developer.android.com/reference/androidx/packages)
[AndroidX开发blog](https://android-developers.googleblog.com/2018/05/hello-world-androidx.html)



## Android 架构设计
1.通过模型驱动界面

    持久性是理想之选，原因如下：
    如果 Android 操作系统销毁应用以释放资源，用户不会丢失数据。
    当网络连接不稳定或不可用时，应用会继续工作。

2.分离关注点

[分离关注点](https://en.wikipedia.org/wiki/Separation_of_concerns)
[应用架构指南](https://developer.android.com/jetpack/docs/guide)
[Android架构组件](https://developer.android.com/topic/libraries/architecture/)

## 配置编译版本

[优化编译的代码](https://source.android.com/devices/tech/dalvik/)

1.配置Gradle依赖库的信息
2.配置Gradle依赖的那些工程
3.配置Gradle使用的环境变量和默认配置
4.配置Gradle编译是使用的控制Gradle的配置变量
5.配置Gradle使用SDK环境变量的位置



测试、部署、签署和分发的 APK

自定义编译配置

  编译版本类型
  正式版类型
  编译变体
  清单条目
  依赖项
  签名
  ProGuard
  多 APK 支持

编译配置文件
  Gradle 设置文件:settings.gradle 文件位于项目根目录，用于指示 Gradle 在编译应用时应将哪些模块包含在内
  顶级编译文件:顶级 build.gradle 文件位于项目根目录，用于定义适用于项目中所有模块的编译配置。默认情况下，顶级编译文件使用 buildscript 代码块来定义项目中所有模块共用的代码库和依赖项。以下代码示例描述的默认设置和 DSL 元素可在新建项目后的顶级 build.gradle 文件中找到。

shrinking, using minifyEnabled, and specifies the Proguard settings file


Gradle 属性文件

Gradle 还包含两个属性文件，位于项目根目录，可用于指定 Gradle 编译工具包本身的设置：
gradle.properties:您可以在其中配置项目范围的 Gradle 设置，如 Gradle 守护进程的最大堆大小。如需了解详情，请参阅编译环境。
local.properties:配置编译系统的本地环境属性，如 SDK 安装路径。由于此文件的内容由 Android Studio 自动生成并且专用于本地开发者环境，因此您不应手动修改此文件或将其检入版本控制系统。


[AndroidStudio不同模块配置](http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.AppExtension.html#N148E3)

启用离线模式
如果网络连接速度比较慢，那么在 Gradle 尝试使用网络资源解析依赖项时，编译时间可能会延长。您可以指示 Gradle 仅使用已缓存到本地的工件，从而避免使用网络资源。

要在使用 Android Studio 编译项目时离线使用 Gradle，请执行以下操作：

依次点击 File > Settings（在 Mac 上，则依次点击 Android Studio > Preferences），打开 Preferences 窗口。
在左侧窗格中，依次点击 Build, Execution, Deployment > Gradle。
勾选 Offline work 复选框。
点击 Apply 或 OK。
如果您正在通过命令行编译，请传递 --offline 选项。

Instant Run：

打开 Settings 或 Preferences 对话框。
依次转到 Build, Execution, Deployment > Instant Run。
确保勾选 Enable Instant Run。

[Android Runtime (ART) 和 Dalvik](https://source.android.com/devices/tech/dalvik/)


## 性能分析

如果应用响应速度慢、动画播放不流畅、卡顿、崩溃或极其耗电，则表示其性能差




[分析应用性能](https://developer.android.com/studio/profile)
